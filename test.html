<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nparam Bull — Clean Sharp UI</title>
  <link rel="icon" type="image/x-icon" href="https://nparam.com/nparam.png">
  <style>
    /* ---------- THEME (no rounded corners anywhere) ---------- */
    :root{
      --bg: #2f3336;            /* page background */
      --panel: #36393e;         /* card / table background */
      --muted: #4a4d52;         /* secondary background */
      --accent: #f08b88;        /* coral accent for headers & CTA */
      --text: #e6e6e6;          /* main text */
      --subtext: #aeb3b6;       /* subdued text */
      --pos: #00c853;           /* vivid green (good contrast) */
      --neg: #ff1744;           /* vivid red */
      --row-border: #2a2d30;    /* separators */
    }

    /* Reset & base */
    *{box-sizing: border-box; border-radius:0;}
    html,body{height:100%;}
    body{
      margin:0; padding:0; font-family: 'Poppins', system-ui, Arial; background:var(--bg); color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      display:flex; flex-direction:column; align-items:center;
    }

    /* Top bar / brand */
    .header{
      width:92%; max-width:1280px; padding:12px 16px; display:flex; align-items:center; gap:12px; margin-top:18px;
      background:transparent; color:var(--subtext);
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:600; color:var(--accent);
    }
    .brand img{height:28px; display:block}
    .subtitle{color:var(--subtext); font-size:13px}

    /* Table container */
    .table-wrap{
      width:92%; max-width:1280px; margin:18px 0 120px 0; background:var(--panel); border:1px solid var(--row-border); overflow:hidden;
    }

    /* Legend and controls */
    .controls{display:flex; justify-content:space-between; align-items:center; padding:12px 16px; gap:12px}
    .legend{display:flex; gap:12px; align-items:center}
    .legend .item{display:flex; gap:8px; align-items:center; font-size:13px; color:var(--subtext)}
    .swatch{width:14px; height:14px; display:inline-block}
    .swatch.pos{background:var(--pos)}
    .swatch.neg{background:var(--neg)}

    /* table & header: sharp corners only on outer box, but table cells kept sharp by default */
    table{width:100%; border-collapse:collapse; table-layout:fixed}
    thead th{
      background:var(--accent); color: #2b2b2b; font-weight:700; text-align:left; padding:12px 10px; border-bottom:1px solid var(--row-border);
      font-size:14px;
    }

    tbody tr{height:56px; border-top:1px solid var(--row-border);}

    td{padding:8px 10px; vertical-align:middle; color:var(--text); border-left:0; border-right:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    /* Ticker column narrower */
    td.ticker{width:10%; font-weight:700; color:var(--text)}
    td.name{width:50%; display:flex; align-items:center; gap:12px}
    td.pred{width:22%; text-align:left}
    td.weight{width:8%; text-align:right; padding-right:18px}

    /* small logo */
    .logo{width:20px; height:20px; display:inline-block}

    /* trend indicator square placed next to company name (easy to glance) */
    .trend-badge{width:14px; height:14px; display:inline-flex; align-items:center; justify-content:center; font-size:11px; color:#fff; font-weight:700}
    .trend-badge.pos{background:var(--pos);}
    .trend-badge.neg{background:var(--neg);}

    /* colors for percent text */
    .percent{font-weight:700}
    .percent.pos{color:var(--pos)}
    .percent.neg{color:var(--neg)}

    /* row hover */
    tbody tr:hover{background:linear-gradient(0deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02))}

    /* sticky header when scrolling table-body */
    .table-scroll{max-height:560px; overflow:auto}
    .table-scroll thead th{position:sticky; top:0; z-index:2}

    /* input area fixed bottom, sharp edges */
    #input-section{position:fixed; bottom:0; left:0; right:0; display:flex; justify-content:center; padding:18px 0; background:linear-gradient(180deg, rgba(0,0,0,0.04), transparent);}
    #input-row{width:92%; max-width:1280px; display:flex; gap:12px}
    #prompt-input{flex:1; min-height:54px; padding:12px; background:var(--muted); color:var(--text); border:1px solid var(--row-border); font-size:16px}
    #submit-button{width:160px; background:var(--accent); color:#2b2b2b; border:1px solid #b86d6b; font-weight:700; cursor:pointer}
    #submit-button:active{transform:translateY(1px)}
    #apibtn{align-self:center; margin-left:14px; color:var(--accent); text-decoration:underline; font-weight:600}

    /* loading */
    #loading-message{display:none; margin:10px 0; color:var(--accent); font-weight:700}

    /* responsive tweaks */
    @media (max-width:800px){
      td.name{width:46%}
      td.pred{width:30%}
      td.ticker{width:16%}
      #submit-button{width:120px}
    }
    @media (max-width:480px){
      .controls{flex-direction:column; gap:8px; align-items:flex-start}
      td.weight{display:none}
      #prompt-input{font-size:14px}
      .table-wrap{margin-bottom:220px}
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="brand">
      <img src="nparam.png" alt="logo">
      <div>
        <div style="font-size:16px">Nparam Bull <span style="color:var(--subtext); font-weight:500">V1 360M+</span></div>
        <div class="subtitle">AI daily % change predictions — quick glance friendly</div>
      </div>
    </div>
  </div>

  <div class="table-wrap" role="region" aria-label="Predicted stock table">

    <div class="controls">
      <div class="legend">
        <div class="item"><span class="swatch pos"></span> Up</div>
        <div class="item"><span class="swatch neg"></span> Down</div>
      </div>
      <div style="color:var(--subtext); font-size:13px">Only information that is not priced in the market can be expected to yield profitable trades — Nparam is not responsible for any loss.</div>
    </div>

    <div class="table-scroll">
      <table id="stock-table">
        <thead>
          <tr>
            <th style="width:10%">Ticker</th>
            <th style="width:50%">Company</th>
            <th style="width:22%">% Change (AI Prediction)</th>
            <th style="width:8%; text-align:right; padding-right:18px">Weight</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

  <div id="loading-message">Generating...</div>

  <div id="input-section">
    <div id="input-row">
      <textarea id="prompt-input" placeholder="Enter your prompt here"></textarea>
      <button id="submit-button">Predict ✦</button>
      <a id="apibtn">API Dashboard ↗</a>
    </div>
  </div>

  <script>
  // Helper: clamp color for very small rounding errors
  function formatPercent(n){
    const sign = n>0 ? '+' : '';
    return sign + n.toFixed(5) + '%';
  }

  document.getElementById('submit-button').addEventListener('click', async () => {
    const prompt = document.getElementById('prompt-input').value.trim();
    const loadingMessage = document.getElementById('loading-message');
    const tableBody = document.querySelector('#stock-table tbody');

    tableBody.innerHTML = '';
    loadingMessage.style.display = 'block';

    try{
      const [companyResp, apiResp] = await Promise.all([
        fetch('company.json'),
        fetch('http://localhost:5000/predict', {
          method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({insight:prompt})
        })
      ]);
      if(!companyResp.ok) throw new Error('company.json load failed');
      if(!apiResp.ok) throw new Error('prediction API failed');

      const companyData = await companyResp.json();
      const preds = await apiResp.json();

      const company = {};
      companyData.forEach(c => company[c.Symbol] = { securityName: c['Security Name'] });

      // compute positive sum and sort by absolute magnitude
      const positiveSum = Object.values(preds).filter(v=>v>0).reduce((s,v)=>s+v,0);
      const sorted = Object.entries(preds).sort((a,b)=> Math.abs(b[1]) - Math.abs(a[1]));

      // render rows
      for(const [ticker, pct] of sorted){
        const name = company[ticker]?.securityName || 'Unknown';
        const positive = pct > 0;

        const tr = document.createElement('tr');

        // Ticker
        const tdTicker = document.createElement('td'); tdTicker.className='ticker'; tdTicker.textContent = ticker; tr.appendChild(tdTicker);

        // Name + logo + trend badge
        const tdName = document.createElement('td'); tdName.className='name';
        const logo = document.createElement('img'); logo.className='logo'; logo.src = 'icons/' + ticker + '.png'; logo.alt = ticker + ' logo';
        logo.onerror = ()=>{ logo.style.display='none'};
        const badge = document.createElement('span'); badge.className = 'trend-badge ' + (positive? 'pos': 'neg'); badge.textContent = positive ? '▲' : '▼';
        const spanName = document.createElement('span'); spanName.textContent = name;
        tdName.appendChild(logo);
        tdName.appendChild(badge);
        tdName.appendChild(spanName);
        tr.appendChild(tdName);

        // Percent change (close to name visually)
        const tdPred = document.createElement('td'); tdPred.className='pred';
        const p = document.createElement('span'); p.className = 'percent ' + (positive? 'pos':'neg'); p.textContent = formatPercent(pct);
        tdPred.appendChild(p);
        tr.appendChild(tdPred);

        // Weight
        const tdWeight = document.createElement('td'); tdWeight.className='weight';
        const weight = (positive && positiveSum>0) ? pct / positiveSum : 0;
        tdWeight.textContent = weight.toFixed(5);
        tr.appendChild(tdWeight);

        tableBody.appendChild(tr);
      }

    }catch(err){
      console.error(err);
      const tableBody = document.querySelector('#stock-table tbody');
      const row = document.createElement('tr');
      const cell = document.createElement('td'); cell.colSpan=4; cell.style.color='var(--subtext)'; cell.textContent = 'Error loading predictions. See console.';
      row.appendChild(cell); tableBody.appendChild(row);
    }finally{
      loadingMessage.style.display = 'none';
    }
  });
  </script>
</body>
</html>
